<a href="https://blog.avocode.com/4-must-know-tips-for-building-cross-platform-electron-apps-f3ae9c2bffff">https://blog.avocode.com/4-must-know-tips-for-building-cross-platform-electron-apps-f3ae9c2bffff</a><div id="articleHeader"><h1>4 must-know tips for building cross platform Electron apps</h1></div><figure id="afc4"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/1*fiCleWsMoHxGEubXLQ_6Hg.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/1*fiCleWsMoHxGEubXLQ_6Hg.png" /></div></figure><p id="55d2"><a href="https://electron.atom.io/" target="_blank">Electron</a>, the technology that powers Avocode among many other apps, allows you to get a cross-platform desktop application up and running very quickly. If you don’t pay attention you will quickly end up in the uncanny valley of apps, though. Apps that don’t feel <em>quite</em> in place among your other apps.</p><p id="2a24">This is a transcript of presentation I gave in May 2016 at the Electron Meetup in Amsterdam, updated to take into account API changes. Mind you, this goes into great detail and assumes some familiarity with Electron.</p><h3 id="def2">First off, who am I?</h3><p id="1f79">I’m Kilian Valkhof, a front-end developer/UX designer/app developer, depending on who you ask. I have over 10 years of experience creating things for the internet, and built a number of desktop apps in various environments such as GTK and Qt, and of course, in Electron.</p><p id="e6e4">The most recent application I built is <a href="https://fromscratch.rocks/" target="_blank">Fromscratch</a>, a free cross-platform auto-saving note taking</p><p id="0282">During the development of Fromscratch, I spent a lot of time making sure the app feels great on all three platforms, and finding out how to make that happen in Electron. These are the gotcha’s I encountered and how-to’s I’ve come up with.</p><p id="2a47">Getting an app to feel nice and consistent in Electron is not difficult, you just have to make sure you pay attention to the details.</p><h3 id="8780">1. Copy and paste on macOS</h3><p id="599b">Imagine, for a moment, you release an app. Say, a note taking app. That you tested and used heavily on your Linux machine. And then you get this friendly message on ProductHunt:</p><figure id="c218"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/0*a_OdGbcxWCCkvNyf.?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/0*a_OdGbcxWCCkvNyf." /></div></figure><p id="95b6"><em>Turns out that by default, Copy and Paste commands are not enabled in Electron on macOS!</em></p><p id="c155">The way to let people copy and paste things into and out of your application is by providing an Application Menu that contains those commands. In your main.js file, Simply adding the code below will give you glorious, full-HD copy-and-paste:</p><pre id="42d1">if (process.platform === 'darwin') { <br />  var template = [{ <br />    label: 'FromScratch', <br />    submenu: [{ <br />      label: 'Quit', <br />      accelerator: 'CmdOrCtrl+Q', <br />      click: function() { <br />        app.quit(); <br />      } <br />    }] <br />  }, { <br />    label: 'Edit', <br />    submenu: [{ <br />      label: 'Undo', <br />      accelerator: 'CmdOrCtrl+Z', <br />      selector: 'undo:' <br />    }, { <br />      label: 'Redo', <br />      accelerator: 'Shift+CmdOrCtrl+Z', <br />      selector: 'redo:' <br />    }, { <br />      type: 'separator'<br />    }, { <br />      label: 'Cut', <br />      accelerator: 'CmdOrCtrl+X', <br />      selector: 'cut:' <br />    }, { <br />      label: 'Copy', <br />      accelerator: 'CmdOrCtrl+C', <br />      selector: 'copy:'<br />    }, { <br />      label: 'Paste', <br />      accelerator: 'CmdOrCtrl+V', <br />      selector: 'paste:' <br />    }, { <br />      label: 'Select All', <br />      accelerator: 'CmdOrCtrl+A', <br />      selector: 'selectAll:' <br />    }] <br />  }];</pre><pre id="5430">  var osxMenu = menu.buildFromTemplate(template);<br />  menu.setApplicationMenu(osxMenu);<br />}</pre><p id="ba62">If you already have a menu, you need to augment it to include the above cut/copy/paste commands.</p><h3 id="3784">1.1 Specify an icon</h3><p id="c37d">…or your app will look like this on Ubuntu:</p><figure id="fa12"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/0*QWzS2in91YXaI_Tf.?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/0*QWzS2in91YXaI_Tf." /></div></figure><p id="6773">Many, <em>many</em> applications get this wrong unfortunately, because on Windows and on macOS, the icon shown in the task bar or dock is the <em>application icon</em> (an .ico or .icns) and on Ubuntu, it’s your <em>window icon</em> that is shown. Adding it is super simple. in your `BrowserWindow` options, just specify an icon:</p><pre id="4585">mainWindow = new BrowserWindow({ <br />  title: 'ElectronApp', <br />  icon: __dirname + '/app/assets/img/icon.png', <br />});</pre><p id="68fb">This will also give you a small icon in the top left of your Windows app.</p><h3 id="6af2">1.2 UI Text is not selectable</h3><p id="c5c0">When you use your browser, word processing software, or any other native application, you will notice that you can’t select the text in your menus and other applications like Chrome. One of the ways an Electron app quickly jumps into the uncanny valley is by accidentally triggering a text selection or highlight on what are supposed to be UI elements.</p><p id="89af">CSS has our back here, though; for any button, menu, or</p><pre id="4151">.my-ui-text { -webkit-user-select:none; }</pre><p id="fb6d">And the text will simply not be selectable anymore. It will feel much more like a native application. A little tip to check this: simply press ctrl/cmd + A to select all selectable text in your app. Then you can quickly spot the items you still need to disallow selection on.</p><h3 id="0034">1.3 You need three icons for three platforms</h3><p id="ba7a">Really, this is just super inconvenient. On Windows, you need an .ico file, on macOS you need a .icns file and on Linux you need a .png file.</p><figure id="7414"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/0*k4jBKVva0PRc-3uc.?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/0*k4jBKVva0PRc-3uc." /></div></figure><p id="cb32">Luckily, the same, normal png can be used to generate the other two icons. Here’s the most convenient way:</p><p id="f363">1. Start with a 1024x1024 pixel PNG. That means we’re already 1/3rd of the way done. (Linux, check!)</p><p id="dcf0">2. For Windows, run it through <a href="http://www.nongnu.org/icoutils/" target="_blank">icotools</a> in your terminal to get an .ico:</p><pre id="980f">icotool -c icon.png &gt; icon.ico</pre><p id="3ad4">3. For macOS, run it through <a href="https://github.com/daveish/png2icns" target="_blank">png2icns</a> in your terminal to get an</p><pre id="37bf">png2icns icon.icns icon.png</pre><p id="54f7">4. You’re done!</p><p id="95a7">There are GUI tools available such as <a href="http://www.img2icnsapp.com/" target="_blank">img2icns</a> on macOS and <a href="https://iconverticons.com/online/" target="_blank">iconverticons</a> on Web, Windows and macOS but I have not used them.</p><h3 id="fd1e">1.4 Bonus!</h3><p id="63b3">electron-packager doesn’t need the extension of the icon to pick the correct one for a given platform:</p><pre id="e541">electron-packager . MyApp — icon=img/icon — platform=all — arch=all — version=0.36.0 — out=../dist/ — asar</pre><p id="7053">Of course, I only figured that one out after writing my own build script that selected the correct version of the icon. Oh well.</p><h3 id="8b6a">2. White loading screens belong in browsers</h3><p id="9c3d">Nothing gives away the inherent <em>browseriness</em> of an Electron app more than a white loading screen. Luckily there are two things we can do to combat that:</p><h3 id="7516">2.1 Specify a BrowserWindow background color</h3><p id="e1d2">If your application has a non-white background color, make sure to specify it in your BrowserWindow options. This won’t prevent the square-of-solid-color while your application loads, but at least it doesn’t also change color halfway through:</p><pre id="4891">mainWindow = new BrowserWindow({ <br />  title: 'ElectronApp', <br />  backgroundColor: '#002b36', <br />});</pre><h3 id="f4cb">2.2 Hide your application until your page has loaded:</h3><p id="cba5">Because we’re actually in the browser, we can choose to hide the windows until we know all our resources have been loaded in. Upon starting, make sure to hide your browser window:</p><pre id="c982">var mainWindow = new BrowserWindow({ <br />  title: 'ElectronApp', <br />  show: false, <br />});</pre><p id="d0b5">Then, when everything is loaded, show the window and focus it so it pops up for the user. You can do this with the “ready-to-show” event on your `BrowserWindow`, which is recommended, or the ‘did-finish-load’ event on your webContents.</p><pre id="b6a0">mainWindow.on('ready-to-show', function() { <br />  mainWindow.show(); <br />  mainWindow.focus(); <br />});</pre><p id="a76c">You want to focus it to make the user aware that your application has loaded.</p><h3 id="06cc">3. Preserve your window dimensions and position</h3><p id="3014">Now, this is one that a lot of “native” apps get wrong as well, and I find it one of the most annoying things ever. It drives me up the wall when a carefully positioned app, upon a next launch, simply resets it position and dimensions back to whatever default the app developer thought would be reasonable. Don’t do that.</p><p id="8be7">Instead, save the window’s position and dimensions and restore them on each launch. Your users will thank you.</p><h3 id="86b1">3.1 Prebuilt solutions</h3><p id="772a">There are two prebuilt solutions that solve this for you, called <a href="https://www.npmjs.com/package/electron-window-state" target="_blank">electron-window-state</a> and <a href="https://www.npmjs.com/package/electron-window-state-manager" target="_blank">electron-window-state-manager</a>. Both of them work, have good documentation and take care of edge cases such as maximised applications. If you’re in a hurry, use these.</p><h3 id="d9d7">3.2 Roll your own</h3><p id="d8a2">You can also roll your own, and that’s what I did, based on code I had already made for <a href="https://trimage.org/" target="_blank">Trimage</a> a few years ago. It’s not a lot of work and it gives you a lot of control. I’ll show you:</p><h4 id="e75f">3.2.1 Get something to save your state to</h4><p id="085e">First off, we need to be able to store the position and dimensions of our application somewhere. You can use <a href="https://github.com/nathanbuchar/electron-settings" target="_blank">Electron-settings</a> which does it very well, but I chose to use <a href="https://www.npmjs.com/package/node-localstorage" target="_blank">node-localstorage</a> because of its simplicity.</p><pre id="d3ad">var JSONStorage = require('node-localstorage').JSONStorage;<br />var storageLocation = app.getPath('userData');<br />global.nodeStorage = new JSONStorage(storageLocation);</pre><p id="9654">If you save your data to <em>`getPath(‘userData’);`</em> electron will store it alongside it’s own application settings, in <em>`~/.config/YOURAPPNAME`</em>, or on Windows, in the appdata folder under your user.</p><h4 id="c442">3.2.2 When opening your app, try to load in your state</h4><pre id="bbd0">var windowState = {}; </pre><pre id="7c44">try { <br />  windowState = global.nodeStorage.getItem('windowstate'); <br />} catch (err) { <br />  // the file is there, but corrupt. Handle appropriately. <br />}</pre><p id="f1e4">Of course this will not work on first launch so you need to deal with that. Probably by providing sensible defaults. Once you have your previous state in a javascript object, just use that information to set your BrowserWindow dimensions:</p><pre id="b342">var mainWindow = new BrowserWindow({ <br />  title: 'ElectronApp', <br />  x: windowState.bounds && windowState.bounds.x || undefined, <br />  y: windowState.bounds && windowState.bounds.y || undefined,   <br />  width: windowState.bounds && windowState.bounds.width || 550, <br />  height: windowState.bounds && windowState.bounds.height || 450, });</pre><p id="1497">As you can see, I add the sensible default in here by providing a fallback value.</p><p id="d2f2">Now in Electron, it’s not possible to start a window in its maximised state, so we need to do that straight after creating our BrowserWindow.</p><pre id="c943">// Restore maximised state if it is set. <br />// not possible via options so we do it here </pre><pre id="1c8f">if (windowState.isMaximized) { <br />  mainWindow.maximize(); <br />}</pre><h4 id="f937">3.2.3 Save your current state on move, resize and close:</h4><p id="20f4">In a perfect world you will only have to save your window state when closing the application, but that will miss all the times the application is terminated for some unknown reason (such as when the power cuts out).</p><p id="2204">Getting and saving the state on every move or resize event makes sure we always restore the last known position and dimensions.</p><pre id="9fdb">['resize', 'move', 'close; ].forEach(function(e) { <br />  mainWindow.on(e, function() { <br />    storeWindowState(); <br />  }); <br />});</pre><p id="1040">And the storeWindowState function:</p><pre id="c715">var storeWindowState = function() { <br />  windowState.isMaximized = mainWindow.isMaximized(); </pre><pre id="30da">  if (!windowState.isMaximized) { <br />    // only update bounds if the window isn’t currently maximized    <br />    windowState.bounds = mainWindow.getBounds(); <br />  }<br /><br />global.nodeStorage.setItem(‘windowstate’, windowState); <br />};</pre><p id="0342">The storeWindowState function has a little gotcha: If you minimise a native maximised window, it will revert to its <em>previous</em> position. This means that when the window state is maximised we want to save that fact, but we don’t then want to overwrite the previous (unmaximised) window dimensions so that if you maximise, close, re-open, and unmaximise, you will end up with the position your window had before maximising.</p><h3 id="3ce2">4. Some quick fire tips</h3><p id="0672">Below are a couple of small, quick tips and tricks.</p><h4 id="31c0">4.1 Shortcuts</h4><p id="7781">In general, Windows and Linux users use Ctrl, while macOS users use Cmd for shortcuts. Instead of adding each shortcut (called an <em>Accelerator</em> in Electron) twice, use “CmdOrCtrl” to target all platforms at once.</p><h4 id="9bdc">4.2 Use the “system font/San Francisco”</h4><p id="384a">Using the default system font means that your application can blend in with the rest of the OS. Instead of hardcoding it for each system separately, you can use the following CSS to automatically pick whatever font is the UI font on a system:</p><pre id="3b1f">cssbody { font: caption; }</pre><p id="adf7">“caption” is a keyword in CSS that links to a platform-specified font.</p><h4 id="1ae6">4.3 System colors</h4><p id="b154">Just like the system font, you can also choose to let the platform determine the colors of your application by using <a href="http://www.sitepoint.com/css-system-styles/" target="_blank">System colors</a>. These are actually deprecated in favor of not-yet-implemented Appearance value type in CSS3, but they’re not going anywhere for the foreseeable future.</p><h4 id="c3c3">4.4 Layouting</h4><p id="a8e9">CSS is an immensely powerful way to lay out applications, especially when you combine flexbox with <em>`calc()`</em>, but don’t discount the work done in older GUI frameworks such as GTK, Qt or Apple Autolayout. You can create your app GUI in a similar way by using <a href="https://gridstylesheets.org/" target="_blank">Grid Stylesheets</a> which is a constraint-based layout system.</p><h3 id="8aa3">Thanks!</h3><p id="ddfa">Building applications in Electron is a lot of fun and very rewarding: you can get something up and running on multiple platforms in a matter of minutes. If you’ve never looked into Electron I hope this article intrigued you enough to take a look. Their<a href="http://electron.atom.io/" target="_blank"> website</a> has excellent documentation as well as a very cool demo app that lets you try out all the API’s on offer.</p><p id="8d4d">If you’re already writing Electron applications, I hope the above encourages you to think about how your app runs on all platforms.</p><p id="0f73">Lastly, If you have any additional tips, please share them in the comments!</p>