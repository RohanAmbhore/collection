<a href="https://medium.com/@gethylgeorge/using-redux-saga-to-handle-side-effects-and-testing-it-using-jest-2dff2d59f899">https://medium.com/@gethylgeorge/using-redux-saga-to-handle-side-effects-and-testing-it-using-jest-2dff2d59f899</a><div id="articleHeader"><h1>Using Redux-Saga to handle side-effects and testing it using Jest</h1></div><div><figure id="6ed0"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/66/1*Ry27qdPxa5jUdQrP5PgWog.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/2000/1*Ry27qdPxa5jUdQrP5PgWog.png" /></div></figure><div><p id="8d52">When I started looking into Redux-Saga, I felt as thought I tripped into a cave and there was no escape even though I could see the light at the distant top.</p><p id="d397">This was mainly because I found it really confusing initially to grasp <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/function*" target="_blank">ES6 Generators</a>, which is used to build Redux-Saga.But once I understood how to redux-saga, <em>I am loving it</em>.</p><p id="dbc3">The intention of this post is to help you understand how to use redux-saga. To get started with it, I would advice you to read the <a href="https://redux-saga.github.io/redux-saga/index.html" target="_blank"><strong><em>official document</em></strong></a> first to understand how you can use it as a middleware to handle side-effects and also try to understand the basics of how <em>ES6 Generators</em> work.</p><p id="373b">I have put across a small example on how to use Redux-Saga <a href="https://github.com/Gethyl/FirstReduxSagaExample" target="_blank"><strong><em>here</em></strong></a>, and also I use <a href="http://facebook.github.io/jest/" target="_blank"><strong><em>Jest</em></strong></a>to test the sagas.</p><blockquote id="3bbb">If you aren’t familiar with Jest, you can check this post I have written on how to test a <a href="https://medium.com/@gethylgeorge/testing-a-react-redux-app-using-jest-and-enzyme-b349324803a9#.sk4coi4t6" target="_blank"><strong>React-Redux app using Jest</strong></a>.</blockquote><p id="c9ee">This is how the basic screen looks before and after I press the button.</p><figure id="0dfd"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/66/1*oN6garppcNKi6o2kagog7g.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1760/1*oN6garppcNKi6o2kagog7g.png" /></div><figcaption>Before clicking on the <strong>Button</strong></figcaption></figure><figure id="1840"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/66/1*2qfVUk0qFrCNBVqnIZPd0A.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1760/1*2qfVUk0qFrCNBVqnIZPd0A.png" /></div><figcaption>After clicking on the <strong>Button</strong></figcaption></figure><p id="0229">Lets not look too much into the details of the screen for now. But we will come to that in the subsequent sections.</p></section><section><div><div><h3 id="c11a">Setting up</h3><p id="f959">The easiest way start working with the example I have provided is to</p><ol><li id="d259">Clone the project into your local folder</li></ol><pre id="6ea4">git clone <a href="https://github.com/Gethyl/FirstReduxSagaExample" target="_blank">https://github.com/Gethyl/FirstReduxSagaExample</a></pre><p id="8c20">2. Change to that folder.</p><pre id="aa26">cd ./<a href="https://github.com/Gethyl/FirstReduxSagaExample" target="_blank">FirstReduxSagaExample</a></pre><p id="b042">3. Install the <em>dependencies</em> and <em>devDependencies </em>by issuing <code>yarn install</code> or <code>npm install</code></p><p id="5d38">I would suggest you to learn and start using <a href="https://yarnpkg.com/" target="_blank"><strong><em>yarn</em></strong></a> over npm. yarn was created to overcome the shortfalls of npm and therefore I would recommend you to start exploring it. Also maybe you can read this <a href="https://medium.com/@shuvohabib/from-npm-to-yarn-should-i-go-for-it-or-not-8d71480ed270#.bchw3npod" target="_blank">article</a> to get convinced :)</p></div></section><section><div><div><h3 id="19dd">Running The Example</h3><p id="deb5">If you check the <code>script</code> in <code>package.json</code> I have added</p><pre id="3bf5">"dev": "webpack-dev-server --content-base --inline --hot"</pre><p id="bac9">So to run your app, all you have to do is</p><pre id="e26a">yarn run dev</pre><p id="a055">And go to <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a> and see the page.</p></div></section><section><div><div><h3 id="4986">Understanding how Redux-Saga works</h3><p id="ef18">Now that you have the app running,</p><figure id="bf6a"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/66/1*oN6garppcNKi6o2kagog7g.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1320/1*oN6garppcNKi6o2kagog7g.png" /></div><figcaption>Before clicking on the <strong>Button</strong></figcaption></figure><p id="d8d3">We will be printing to the screen <code>this.props.output</code> so that it’s easy for you to understand the flow of the app.</p><p id="46fa">When the screen is rendered initially, you can see that we put initial state of the app in the list.</p><pre id="1118"><strong>initialState</strong> = {output:"@@redux/INIT action triggered"}</pre><p id="a073">Next, click on the button <strong>Click to Fetch Async Data</strong>, and you will see that the list has few more messages.</p><p id="607b">These messages are useful in understanding how our app works.</p><figure id="a4b5"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/66/1*2qfVUk0qFrCNBVqnIZPd0A.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1760/1*2qfVUk0qFrCNBVqnIZPd0A.png" /></div><figcaption>After clicking on the <strong>Button</strong></figcaption></figure><p id="93e6">Now let us look at each of the messages to understand when they were triggered.</p><blockquote id="54e7">To keep things simple, <strong>the reducer always returns</strong></blockquote><blockquote id="f619"><code>return {…state,output:action.output}</code></blockquote><h4 id="3048">1. ASYNC_TEST_SAGA triggered from TestContainer.js</h4><p id="757c"><strong>When the button is clicked</strong>, we dispatch the action <code>ASYNC_TEST_SAGA</code></p><pre id="96ae">//TestContainer.js</pre><pre id="12d3">dispatch(asyncTestSaga("ASYNC_TEST_SAGA triggered from TestContainer.js"))</pre><p id="0c51">The actionCreator:</p><pre id="6bbd">//middlewareActions.js</pre><pre id="42c4">export const asyncTestSaga = (output) =&gt; {<br />    return {<br />        type: "ASYNC_TEST_SAGA",<br />        output: output //"ASYNC_TEST_SAGA triggered from Action"<br />    }<br />}</pre><p id="7e86">And you see the message printed on the screen. There is nothing special happening here and it is not a side-effect.</p><blockquote id="7808">But the next items which are printed are interesting, because this is where redux-saga comes in picture, as they are side-effects when we trigger the above action.</blockquote><p id="49bf">Let me display the entire <code>sagas.js</code> here so that it becomes easier for you in the subsequent steps.</p><figure id="ac84"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F15939823%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><h4 id="707c">2. ASYNC_TEST -ASYNC_TEST_SAGA triggered from TestContainer.js</h4><p id="5530">Since we use Redux-Saga middle ware to capture side-effects as shown below:-</p><pre id="ae36">//sagas.js</pre><pre id="306d">export default function* rootSaga (){  <br />     yield takeEvery("ASYNC_TEST_SAGA",testFunction0) <br />}</pre><p id="084a">What this does it, every time, we click the button and when <code>ASYNC_TEST_SAGA</code> action is fired, as we catch it for side-effects using Redux-Saga and call the function <code>testFunction0</code> .</p><blockquote id="d960"><strong>takeEvery</strong> will pass the <em>action</em> as the third parameter. If you explicitly pass arguments, then <em>action</em> will be appended to the end of the arguments.</blockquote><p id="e75e">This is why <code>testFunction0</code> receives action as parameter.</p><pre id="84ed">export  function* testFunction0 (action){<br />    yield call(testFunction1,action.output)<br />    ...<br />}</pre><p id="9ae8">This will in turn call, <code>testFunction1</code></p><pre id="83f6">export  function* testFunction1 (sagaPut){<br />    yield call(delay, 1000)  <br />    yield put({type: 'ASYNC_TEST', output:"ASYNC_TEST -" + sagaPut})<br />    ...<br />}</pre><p id="9b82">Here you can see that we are prefixing “<strong>ASYNC-TEST -“ </strong>to the output passed, and call the action <strong>ASYNC_TEST.</strong></p><blockquote id="e610">Notice here, we are directly calling an <strong>action</strong> and not an actionCreator. Though this is possible and I have used it just to show you guys, I would strictly advice to use actionCreators to maintain consistency.</blockquote><h4 id="03dd">3. ASYNC_TEST_INITIAL Action Creator!!</h4><p id="7f43">Next, moving to the next line in <code>testFunction1</code></p><pre id="0b31">export  function* testFunction1 (sagaPut){<br />    ...</pre><pre id="d6f9">    yield put(asyncTestInitial())<br />    ...<br />}</pre><p id="7961">It call <code>asyncTestInitial</code> actionCreator.</p><pre id="9bf4">export const asyncTestInitial = () =&gt; {<br />    return {<br />        type: "ASYNC_TEST_INITIAL",<br />        output: "ASYNC_TEST_INITIAL Action Creator!!" <br />    }<br />}</pre><h4 id="b36f">4. This action is not present in ActionCreator</h4><p id="19e1">Next, moving to the last line in <code>testFunction1</code></p><pre id="8426">export  function* testFunction1 (sagaPut){<br />    ...</pre><pre id="06bf">    yield put({type: 'ASYNC_TEST_NOACTIONCREATOR', output:"This action is not present in ActionCreator"})<br />}</pre><p id="f292">You can see again, we are directly using action without an actionCreator. Though it is possible, please use actionCreators through out the app for consistency.</p><h4 id="fa7e">5. ASYNC_FETCH_INITIAL action triggered!!</h4><p id="b1f9">Now that all the lines in<code>testFunction1</code> are executed, we execute the next line in<code>testFunction0</code></p><pre id="cc68">export  function* testFunction0 (action){<br />    ...</pre><pre id="e289">    yield call(delay,1000)<br />    yield put(asyncFetchInitial())<br />    ...</pre><pre id="0084">}</pre><p id="13a8">Having actionCreator:</p><pre id="bb0f">export const asyncFetchInitial = () =&gt; {<br />    return {<br />        type: "ASYNC_FETCH_INITIAL",<br />        output: "ASYNC_FETCH_INITIAL action triggered!!" <br />    }<br />}</pre><h4 id="eecb">6. ASYNC_FETCH_SUCCESS Fetch was successfull!!</h4><p id="afff">And finally we make fetch <code>testdata.json</code> and display the field <strong>dummyOutput</strong></p><pre id="72ec">export  function* testFunction0 (action){<br />    ...<br />    try {<br />        const dummyOutput = yield call(FetchTestData)<br />        yield put(asyncFetchSuccess(dummyOutput))<br />    } catch (error) {<br />        console.log("Error in fetch" + error)<br />        yield put(asyncFetchError())<br />    }</pre><pre id="5a58">}</pre><p id="e77c"><strong>FetchTestData</strong>:</p><pre id="2e78">export function FetchTestData(){<br />    return fetch('testdata.json')<br />       .then((res)=&gt; res.json())<br />       .then((jsondata)=&gt; {<br />           const {dummyOutput} = jsondata.dummy<br />           return dummyOutput<br />       })<br />}</pre><p id="9570">Having actionCreator:</p><pre id="b72b">export const asyncFetchSuccess = (dummyOutput) =&gt; {<br />    return {<br />        type: "ASYNC_FETCH_SUCCESS",<br />        output: "ASYNC_FETCH_SUCCESS ".concat(dummyOutput)<br />    }<br />}</pre><h3 id="97e7">Running Tests</h3><p id="5607">If you check the <code>script</code> in <code>package.json</code> I have added <code>”test”: “jest”</code></p><p id="e7c7">So to run the test all you have to do is</p><pre id="62cf">yarn test</pre><p id="9a1b">And <strong>Jest</strong> will pick all the test files which are put under the folder <code>__test__</code>.</p><h3 id="2e23">Conclusion</h3><p id="7855">As you can see how the items are build in the list, I hope this will give you a clear idea on how the side-effects are captured by Redux-Saga.</p><p id="ea0a">This is just an extremely simple example on how to use Redux-Saga, and it can do much more complex side-effects.</p><blockquote id="5ae3">As always …. Happy Coding!! :-)</blockquote></section>