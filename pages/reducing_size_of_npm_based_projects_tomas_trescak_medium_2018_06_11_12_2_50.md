<a href="https://medium.com/@tomi.trescak/reducing-size-of-npm-based-projects-1b02ebe32d61">https://medium.com/@tomi.trescak/reducing-size-of-npm-based-projects-1b02ebe32d61</a><div id="articleHeader"><h1>Reducing size of NPM based projects</h1></div><p id="bc35">Recently, I purchased a new computer and I was setting up a new development environment with a cloud backup. When I started to move files from one computer to another, <strong>I learned that my 43 javascript projects (web, mobile apps, NPM and Meteor packages) contain 2.7 MILLION files in total of 42 GB!</strong> My internet cloud backup has estimated 250 days to complete. I felt similar to this:</p><figure id="a397"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/90/1*d7jQf7IrqIyI2HUApNRH0g.jpeg?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/2000/1*d7jQf7IrqIyI2HUApNRH0g.jpeg" /></div><figcaption>The moment you realise you produces 2.7 Million files</figcaption></figure></section><section><div><div><p id="8ad0">When I analysed what consisted of these files <strong>I found out that 93% were stored in node_modules folders with 90% redundancy, some being copied 30 times or more!</strong> I guess, when you just go on typing those <em>npm install</em>s you do not realise how much stuff is landing on your computer.</p><p id="6e49">The reason is quite simple, each <em>npm install</em> puts in your node_modules folder the latest versions of packages as specified in your package.json and all of their dependencies. Since each project is in a different state and uses different versions, logically they will keep different files. Yep … but as I’m trying to maintaim all my projects up to date, I end up with all the redundancies, having the same NPM package copied over and over to a different directory.</p><p id="ba56"><a href="https://github.com/npm/npm/issues/12515" target="_blank">When I posted my question in NPM issues</a>, I got no meaningful response (I got 1 in total :). But I did not give up and set out to solve this problem myself by writing an npm extension that would symlink modules into the node_modules directory. This brought upon me yet another shitstorm of problems, but I ended up <a href="https://github.com/nodejs/node/issues/3402" target="_blank">studying following thread</a> that pointed me towards the <a href="https://github.com/rstacruz/pnpm" target="_blank">AMAZING pnpm project</a>.</p></div></section><section><div><div><p id="6044">Not only pnpm is blazing fast, much faster than npm, it solved all the problem with symlinking the modules into so called <strong>store </strong>inside the project directory.</p><p id="5fdd"><strong>Long story short, using pnpm I have reduced the amount of files to little over 300.000 and size dropped to 4GB. That’s around 89% reduction in amount of files and directory size! </strong>My cloud backup finished in reasonable time and moving projects and copying boilerplates is a breeze.</p><figure id="95df"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/90/1*7vo46mOSZkIMEP8OPrDRgg.jpeg?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/2000/1*7vo46mOSZkIMEP8OPrDRgg.jpeg" /></div><figcaption>Image courtesy of HelloGiggles.com</figcaption></figure></section><section><div><div><p id="82f9">Since pnpm create a separate store in each project, I had to tweak the settings of pnpn to create a global store, shared by all the projects. You can follow the update on this issue <a href="https://github.com/rstacruz/pnpm/issues/214" target="_blank">here</a>. What you can do to make it work now?</p><ol><li id="19d0">First, fork the pnpm project and clone it into your directory</li></ol><p id="5c73">2. In the cloned directory open the <em>‘lib/config.js’ </em>file and modify path of the store to the directory of your desire.</p><pre id="af78">module.exports = require(‘rc’)(‘pnpm’, {<br /> ...<br /> store_path: ‘/Users/tomi/.npmstore’,<br /> ...<br />})</pre><p id="a8fd">3. In the cloned directory run <em>npm link </em>to create a global module</p><p id="6f69">DONE!</p><p id="f68c">All you can do now is to delete your node_modules folder run <strong><em>‘pnpm install’ </em></strong>and watch the magic happen!</p></div></section>