<a href="https://hackernoon.com/api-testing-with-jest-d1ab74005c0a">https://hackernoon.com/api-testing-with-jest-d1ab74005c0a</a><div id="articleHeader"><h1>API testing withÂ Jest</h1></div><p id="d9df">Testing async API calls using Jestâ€™s mocking features</p><figure id="440c"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/1*BLqWm6Jf20GfPj3yuSz6SQ.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/1*BLqWm6Jf20GfPj3yuSz6SQ.png" /></div></figure><p id="9889">Jest is a great JavaScript testing framework by Facebook. Itâ€™s often used for testing React components, but itâ€™s also a pretty good general purpose testing framework. In this tutorial Iâ€™ll give a quick and simple demo of itâ€™s mocking capabilities for testing async functions.</p><h3 id="dc5f">Purpose ofÂ mocking</h3><p id="71e4">Mocking async function (like API calls) instead of testing with a real API is useful for a couple of reasons:</p><ul><li id="43b2">Itâ€™s faster: you donâ€™t have to wait until the API response comes in and you donâ€™t have to deal with rate limits.</li><li id="2f39">It makes your tests â€˜pureâ€™, i.e. whether they fail or pass depends only on your code, and not on the data that the API returns.</li><li id="4582">Itâ€™s easier in the long run: no need to first login or set some state before you can start testing a certain endpoint.</li></ul><h3 id="3d6a">Setting upÂ Jest</h3><p id="4cbe">Configuring Jest <a href="https://facebook.github.io/jest/docs/getting-started.html" target="_blank">isnâ€™t all that difficult</a>, but to get started quickly Iâ€™m using the official starter kit by Facebook, <a href="https://github.com/facebookincubator/create-react-app" target="_blank">create-react-app</a>. This comes with a working Jest configuration out of the box!</p><p id="34ab">Install the create-react-app and create the app:</p><pre id="71f8">yarn global add create-react-app<br /><br />create-react-app mocking-with-jest<br />cd mocking-with-jest/<br />yarn start</pre><p id="723f">This should open a browser window with a spinning React logo.</p><p id="27a8">Now start the Jest testing environment:</p><pre id="0e29">yarn test</pre><p id="f1a1">You should see something like this:</p><figure id="de0b"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/1*S0CouXwfhsjpfpMipoG36w.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/1*S0CouXwfhsjpfpMipoG36w.png" /></div></figure><p id="f0d2">Congratulations, youâ€™ve now got Jest up and running and are ready to start writing some tests!</p><h3 id="8daa">Adding theÂ API</h3><p id="5eb8">Weâ€™ll be using <a href="https://github.com/cujojs/rest" target="_blank">rest.js</a> for the making the API requests. Rest.js works well in the browser and Node.js.</p><pre id="6039">yarn add rest</pre><p id="1dc4">Create a new folder <em>api</em> in the folder <em>src </em>and add the file <strong>github.js</strong> with the following code:</p><figure id="d048"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="5aeb">Then also add <strong>request.js</strong>with the following code:</p><figure id="59b2"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="acc1">Youâ€™re now ready to make API requests using: <strong>github.getUser(â€˜vnglstâ€™)</strong>. Letâ€™s test this quickly in the browser. Replace the original contents in the file <strong>App.js </strong>with the following code:</p><figure id="85eb"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="a9b2">Use <strong>yarn start </strong>to open up a browser and see the result. You should see a simple list with my profile data. It works!</p><h3 id="0a12">Writing tests</h3><p id="e04f">Weâ€™re now ready to write some tests. Letâ€™s first try to unit test the function <strong>getUser</strong>. Create a folder <strong>__tests__</strong> and in this folder a file <strong>github.test.js</strong> with the following code:</p><figure id="2525"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="7c09">Start Jest using <strong>yarn test </strong>and you should see the following error message:</p><figure id="cc11"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/60/1*-9BbQ4oJCfXLfrS5GpGn0A.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/1600/1*-9BbQ4oJCfXLfrS5GpGn0A.png" /></div></figure><p id="b120">Whatâ€™s happening here? It turns out that using our <strong>getUser</strong> function in a Node environment (which Jest is using to run the tests) makes our request fail. So even though our function works in the browser, it fails in our tests! Would could try and fix this, by adding a <em>User-Agent</em> header when weâ€™re running this in a Node environment, but mocking would now be a better solution. Letâ€™s set this up!</p><h3 id="477d">Creating aÂ mock</h3><p id="075a">Create a folder __mocks__ and in this folder a file <strong>request.js</strong> (this will be the mocked version of request.js in the parent folder):</p><figure id="e692"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="502c">The mocked function expects a <em>userId.json</em> (i.e. <em>vnglst.json</em>) file in a folder __mockData__. Iâ€™ve used my own Github username and data as an example here, but you can add as many example data as you need for your tests:</p><figure id="f8ed"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure><p id="60df">To let Jest mock the request module, you have to add the following line to <strong>github.test.js </strong>file:</p><pre id="a7cb">jest.mock(â€˜../requestâ€™)</pre><p id="cb4e">Now the simple unit test should pass and youâ€™re ready to write more complicated tests!</p><p id="e18e">I hope you enjoyed this tutorial and feel free to ask me any questions. You can find me on Twitter as <a href="https://twitter.com/vnglst/" target="_blank">@vnglst</a>. The source code of this tutorial can be found here: <a href="https://github.com/vnglst/mocking-with-jest" target="_blank">https://github.com/vnglst/mocking-with-jest</a></p><p id="11d6">This tutorial is based upon the <a href="https://facebook.github.io/jest/docs/tutorial-async.html#content" target="_blank">async example</a> by the creators of Jest (and their example is probably better ðŸ˜‚). Be sure to also check out their other examples.</p><h4 id="b5e6"><em>BONUS: testing using async/await</em></h4><p id="c7c2">If youâ€™re using the <strong>create-react-app </strong>you can also use async/await to write your tests. This definitely makes your tests easier to write and more readable:</p><figure id="4b41"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars2.githubusercontent.com%2Fu%2F3457693%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd&width=40" /></div></figure>