<a href="https://www.ssh.com/ssh/copy-id">https://www.ssh.com/ssh/copy-id</a><div id="articleHeader"><h1>ssh-copy-id</h1></div><p><code>ssh-copy-id</code> installs an <a href="key/" id="RnyYW41kw9RDAg" target="_blank">SSH key</a> on a server as an authorized key. Its purpose is to provision access without requiring a password for each login. This facilitates automated, passwordless logins and single sign-on using the SSH protocol.</p><p>The <code>ssh-copy-id</code> tool is part of <a href="openssh/" id="5vqsv7H53IuMVw" target="_blank">OpenSSH</a>.</p><h2 id="sec-Setting-up-public-key-authentication">Setting up public key authentication</h2><p>Key based authentication in SSH is called <a href="public-key-authentication" id="QR6SIT31EvFMug" target="_blank">public key authentication</a>. The purpose of <code>ssh-copy-id</code> is to make setting up public key authentication easier. The process is as follows.</p><h3 id="sec-Generate-an-SSH-Key">Generate an SSH Key</h3><p>With <a href="openssh/" target="_blank">OpenSSH</a>, an SSH key is created using <a href="keygen/" id="0YTGMfTuSb3Dvw" target="_blank">ssh-keygen</a>. In the simplest form, just run <code>ssh-keygen</code> and answer the questions. The following example illustates this.</p><pre><code># ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ylo/.ssh/id_rsa): mykey
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in mykey.
Your public key has been saved in mykey.pub.
The key fingerprint is:
SHA256:GKW7yzA1J1qkr1Cr9MhUwAbHbF2NrIPEgZXeOUOz3Us ylo@klar
The key's randomart image is:
+---[RSA 2048]----+
|.*++ o.o.        |
|.+B + oo.        |
| +++ *+.         |
| .o.Oo.+E        |
|    ++B.S.       |
|   o * =.        |
|  + = o          |
| + = = .         |
|  + o o          |
+----[SHA256]-----+
#
</code></pre><p>Creating a key pair (public key and private key) only takes a minute. The key files are usually stored in the <code>~/.ssh</code> directory.</p><h3 id="sec-Copy-the-key-to-a-server">Copy the key to a server</h3><p>Once an SSH key has been created, the <code>ssh-copy-id</code> command can be used to install it as an <a href="authorized-key" id="T28kQshgcgzDWg" target="_blank">authorized key</a> on the server. Once the key has been authorized for SSH, it grants access to the server without a password.</p><p>Use a command like the following to copy SSH key:</p><pre><code>ssh-copy-id -i ~/.ssh/mykey user@host
</code></pre><p>This logs into the server host, and copies keys to the server, and configures them to grant access by adding them to the <a href="authorized_keys/" id="mF22CT_srMtL2A" target="_blank">authorized_keys</a> file. The copying may ask for a password or other authentication for the server.</p><p>Only the public key is copied to the server. The private key should never be copied to another machine.</p><h3 id="sec-Test-the-new-key">Test the new key</h3><p>Once the key has been copied, it is best to test it:</p><pre><code>ssh -i ~/.ssh/mykey user@host
</code></pre><p>The login should now complete without asking for a password. Note, however, that the command might ask for the passphrase you specified for the key.</p><h3 id="sec-Troubleshooting">Troubleshooting</h3><p>There are a number of reasons why the test might fail:</p><ul><li>The server might not be configured to accept public key authentication. Make sure <a href="sshd_config/" id="9GE4YXkc_skY5Q" target="_blank">/etc/ssh/sshd_config</a> on the server contains <code>PubkeyAuthentication yes</code>. Remember to restart the <a href="sshd/" id="9_cBsBSTnOPCvQ" target="_blank">sshd</a> process on the server.</li><li>If trying to login as <a href="../iam/user/root/" id="vemuorzpsfH1Ow" target="_blank">root</a>, the server might not be configured to allow root logins. Make sure <code>/etc/sshd_config</code> includes <code>PermitRootLogin yes</code>, <code>PermitRootLogin prohibit-password</code>, or <code>without-password</code>. If it is set to <code>forced-commands-only</code>, the key must be manually configured to use a forced command (see <code>command=</code> option in <code>~/.ssh/authorized_keys</code>.</li><li>Make sure the client allows public key authentication. Check that <a href="config/" id="REXCNC43mQQ3Xw" target="_blank">/etc/ssh/config</a> includes <code>PubkeyAuthentication yes</code>.</li><li>Try adding <code>-v</code> option to the <code>ssh</code> command used for the test. Read the output to see what it says about whether the key is tried and what authentication methods the server is willing to accept.</li><li>OpenSSH only allows a maximum of five keys to be tried authomatically. If you have more keys, you must specify which key to use using the <code>-i</code> option to <code>ssh</code>.</li></ul><h2 id="sec-How-ssh-copy-id-works">How ssh-copy-id works</h2><p><code>ssh-copy-id</code> uses the <a href="protocol/" id="aYkIbHH5ey7sMA" target="_blank">SSH protocol</a> to connect to the target host and upload the SSH user key. The command edits the <code>authorized_keys</code> file on the server. It creates the <code>.ssh</code> directory if it doesn't exist. It creates the authorized keys file if it doesn't exist. Effectively, ssh key copied to server.</p><p>It also checks if the key already exists on the server. Unless the <code>-f</code> option is given, each key is only added to the authorized keys file once.</p><p>It further ensures that the key files have appropriate permissions. Generally, the user's home directory or any file or directory containing keys files should not be writable by anyone else. Otherwise someone else could add new authorized keys for the user and gain access. Private key files should not be readable by anyone else.</p><h2 id="sec-Some-best-practices-for-SSH-keys">Some best practices for SSH keys</h2><p>SSH keys are very useful, but can lead to problems if they are not properly managed. They are access credentials just like user names and passwords. If they are not properly removed when people leave or systems are decommissioned, no-one may any longer know who really has access to which systems and data. Many large organizations have ended up having millions of SSH keys.</p><h3 id="sec-Use-a-passphrase-when-possible">Use a passphrase when possible</h3><p>It is recommended that keys used for single sign-on have a passphrase to prevent use of the key if it is stolen or inadvertatly leaked. The <a href="agent" id="rkzPKGs8pId8Kg" target="_blank">ssh-agent</a> and <a href="add" id="D68R0OEaQM-LqA" target="_blank">ssh-add</a> programs can be used to avoid having to enter the passphrase every time the key is used.</p><p>Generally all keys used for interactive access should have a passphrase. Keys without a passphrase are useful for fully automated processes. They allow shell scripts, programs, and management tools to log into servers unattended. This is often used for backups and data transfers between information systems.</p><h3 id="sec-Add-a-command-restriction-when-possible">Add a command restriction when possible</h3><p>The <code>copy-id</code> tool does not automatically add command restrictions to keys. Using command restrictions is highly recommended when the key is used for automating operations, such as running a report for fetching some files. A command restriction is basically a <code>command="&lt;permitted command&gt;"</code> option added to the beginning of the line in the server's <a href="authorized_keys/" id="EguiOEP0p7PDOg" target="_blank">authorized_keys</a> file.</p><h3 id="sec-Managing-SSH-keys">Managing SSH keys</h3><p>Anyone having more than a few dozen servers is strongly recommended to <a href="../iam/ssh-key-management/" target="_blank">manage SSH keys</a>. Not managing the keys exposes the organization to substantial risks, including loss of confidentiality, insertion of fraudulent transactions, and outright destruction of systems.</p><p>The <code>copy-id</code> tool can be dangerous. It can easily accidentally install multiple keys or unintended keys as authorized. The logic for choosing which key to install is convoluted. Extra authorized keys grant permanent access. They can later be used to spread attacks host-to-host, and the more keys there are, the higher the risk. It also violates all <a href="../compliance/" id="TOu4a2OE6Q2A4w" target="_blank">regulatory compliance requirements</a>.</p><p>The <a href="../products/universal-ssh-key-manager/" id="PFsD-RPGqwI1tQ" target="_blank">Universal SSH Key Manager</a> is a widely used product for managing SSH keys.</p><h2 id="sec-Command-line-options">Command-line options</h2><p>The sample below presents <em>ssh-copy-id</em> command line syntax:</p><pre><code>ssh-copy-id [-f] [-n] [-i identity file] [-p port] [-o ssh_option] [user@]hostname
</code></pre><p>The options have the following meaning:</p><p><strong>-f</strong> Don't check if the key is already configured as an authorized key on the server. Just add it. This can result in multiple copies of the key in <code>authorized_keys</code> files.</p><p><strong>-i</strong> Specifies the identity file that is to be copied (default is <code>~/.ssh/id_rsa</code>). If this option is not provided, this adds all keys listed by <code>ssh-add -L</code>. Note: it can be multiple keys and <strong>adding extra authorized keys can easily happen accidentally</strong>! If <code>ssh-add -L</code> returns no keys, then the most recently modified key matching <code>~/.ssh/id*.pub</code>, excluding those matching <code>~/.ssh/*-cert.pub</code>, will be used.</p><p><strong>-n</strong> Just print the key(s) that would be installed, without actually installing them.</p><p><strong>-o ssh_option</strong> Pass <code>-o ssh_option</code> to the SSH client when making the connection. This can be used for overriding configuration settings for the client. See <a href="command/" id="OMMzHdGlhGWlQw" target="_blank">ssh command line options</a> and the possible configuration options in <a href="config/" target="_blank">ssh_config</a>.</p><p><strong>-p port</strong> Connect to the specifed SSH port on the server, instead of the default port 22.</p><p><strong>-h</strong> or <strong>-?</strong> Print usage summary.</p><h2 id="sec-Ssh-copy-id-on-Mac">Ssh-copy-id on Mac</h2><p>While MacOS includes SSH, it does not include <code>ssh-copy-id</code> out of the port. However, according to some sources MacOS 10.12.4 includes it, and presumably newever versions include it as well.</p><p>You can test whether your Mac has it by opening a terminal window (Finder / Go / Utilities / Terminal) and typing <code>ssh-copy-id</code>.</p><p>If your system does not have it, there are many ways to install ssh-copy-id Mac version.</p><h3 id="sec-Installation-using-Homebrew">Installation using Homebrew</h3><p>To install it using Homebrew, use the following command. You need to have the <code>brew</code> command installed.</p><pre><code>brew install ssh-copy-id
</code></pre><h3 id="sec-Installation-from-MacPorts">Installation from MacPorts</h3><p>The following command will install it using MacPorts. You need to have the <code>port</code> command installed.</p><pre><code>sudo port install openssh +ssh-copy-id
</code></pre><h3 id="sec-Installation-using-Curl">Installation using Curl</h3><p>The following command can be used to install a Mac version directly. Note that as a general rule we do not recommend piping any commands from the network to the shell, like this does. Only use this method if you fully trust the source. The advantage of this method is that it does not need any special software - <code>curl</code> comes preinstalled.</p><pre><code>curl -L https://raw.githubusercontent.com/beautifulcode/ssh-copy-id-for-OSX/master/install.sh | sh 
</code></pre>