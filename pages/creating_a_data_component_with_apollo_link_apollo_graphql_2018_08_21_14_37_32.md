<a href="https://blog.apollographql.com/creating-a-data-component-with-apollo-link-f0719d8193ee">https://blog.apollographql.com/creating-a-data-component-with-apollo-link-f0719d8193ee</a><div id="articleHeader"><h1>Creating a data component with Apollo Link</h1></div><h2 id="70ec">Getting started with customizing your GraphQL client</h2><figure id="4c1b"><div><div><img src="https://cdn-images-1.medium.com/freeze/max/75/1*WzOGBXsyu_Vb-Ho1gNIGzw.png?q=20" /><div class="readableLargeImageContainer"><img src="https://cdn-images-1.medium.com/max/2000/1*WzOGBXsyu_Vb-Ho1gNIGzw.png" /></div><figcaption>The entire implementation of apollo-link-error!</figcaption></figure><p id="7978">With the ever-nearing release of <a href="https://dev-blog.apollodata.com/whats-coming-in-apollo-client-2-0-bcd8ea64acbd" target="_blank">Apollo Client 2.0,</a> there’s no better time to learn some of the new features that make the 2.0 the most flexible and powerful version ever.</p><p id="9a00">One of the ways to leverage this new flexibility is by using the <a href="https://github.com/apollographql/apollo-link" target="_blank">Apollo Link library</a> to customize what happens each time you send an operation to Apollo. Links are designed to be composed together to form control flow chains to manage a request, and they can be used as:</p><ul><li id="5594">Middleware to perform side effects, modify the operation, or even just provide developer tools like logging.</li><li id="d866">Afterware which process the result of an operation, handle errors, or even save the data to multiple locations.</li><li id="8e76">Network fetchers including HTTP, websockets, and even across the react-native bridge to the native network stack.</li></ul><p id="4cba">This article will outline some of the core concepts to get you started. For a deeper dive, checkout the new <a href="https://www.apollographql.com/docs/link/" target="_blank">link docs!</a></p><h3 id="b940">What is a link?</h3><p id="7f28">One of the authors of Apollo Link, <a href="https://medium.com/@evanshauser" target="_blank">Evans Hauser,</a> does a great job of outlining the goals of the package in his <a href="https://dev-blog.apollodata.com/apollo-link-the-modular-graphql-network-stack-3b6d5fcf9244" target="_blank">introductory post</a>. Building on top of that knowledge, the library is designed to be a powerful way to compose actions around data handling with GraphQL. Each link represents a subset of functionality that can be composed with other links to create complex control flows of data. At a basic level, a link is a function that takes a GraphQL request and returns an observable. To learn more about observables, take a look at the proposal <a href="https://github.com/tc39/proposal-observable" target="_blank">here</a> and read the incredible work of <a href="https://medium.com/@benlesh" target="_blank">Ben Lesh</a> such as <a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87" target="_blank">this article</a>.</p><p id="ed85">A individual link isolate parts of the control flow of your GraphQL request into a single unit. For example, you could have a link that logs errors to your monitoring tool of choice. This error link doesn’t need to know anything else about how you are executing your request, just that it starts with an operation and eventually data will hopefully come back.</p><h4 id="6dc7">Request</h4><p id="5a8e">At the core of a link is the <code>request</code> method. A link’s request is called every time <code>execute</code> is run on that link chain. The request is where the operation is given to the link to return back data of some kind. Depending on where the link is in the stack, it will either use the second parameter to a link (the next link in the chain) or return back an <code>ExecutionResult</code> on its own.</p><p id="626d">The full description of a link’s request can be represented like this:</p><figure id="56bf"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>Types of a link</figcaption></figure><h4 id="cc8a">Terminating links</h4><p id="136f">Since link chains have to fetch data at some point, they have the concept of a terminating link and non-terminating links. Simply enough, the terminating link is the one that doesn’t use the <code>forward</code> argument, but instead turns the operation into the result directly. Typically, this is done with a network request, but the possibilities are endless of how this can be done. The terminating link is the last link in the composed chain.</p><h4 id="bd4d">Context</h4><p id="87ac">Links are meant to be composed into a single chain to handle an operation. Because of this, they need an easy way to send metadata about the request down the chain. They also need a way for the operation to send specific information to a link no matter where it was added to the chain. This is very similar to how context works in React. To accomplish this, each operation has a context object which can be accessed and manipulated by each link. For example:</p><figure id="28d0"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>Using the context of a link</figcaption></figure><p id="3c74">Each context can be set by the operation it was started on. For example with Apollo Client:</p><figure id="d322"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>passing context from an operation to a link</figcaption></figure><h3 id="c37f">Building a chain of links</h3><p id="d6ea">Since links represent small portions of how you want your GraphQL operation to be handled, in order to serve all of the needs of your app they designed to be composed with other links as needed. Composition is managed in two main ways: additive and directional. Additive composition is how you can combine multiple links into a single chain, and directional is how you can control which links are used depending on the operation.</p><h4 id="0b7f">Additive</h4><p id="5a3b">Apollo Link ships with two ways to compose links. The first is a method called <code>from </code>which is both exported, and is on the <code>ApolloLink</code> interface. <code>from </code>takes an array of links and combines them all into a single link. For example:</p><figure id="95b6"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>composing multiple links using the from method</figcaption></figure><p id="c8e1"><code>from</code> is typically used when you have many links to join together all at once. The alternative way to join links is the <code>concat</code> method which joins two links together into one.</p><figure id="246d"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div></figure><h4 id="a220">Directional</h4><p id="0722">Given that links are a way of implementing custom control flow for your GraphQL operation, Apollo Link provides and easy way to use different links depending on the operation itself (or any other global state). This is done using the <code>split</code> method which is exported as a function and is on the <code>ApolloLink</code> interface. Using the split function can be done like this:</p><figure id="a696"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>using split to send operations to different backends</figcaption></figure><h3 id="b37b">Stateless vs Stateful</h3><p id="6a4a">Links are typically created and shared between every request in your application. However, most links do the same thing for each request and don’t need any knowledge about other operations being performed. These links are called stateless links because they have no shared execution state between requests. Stateless links can be written as simple functions wrapped in the <code>ApolloLink</code> interface. For example:</p><figure id="0167"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div><figcaption>simple stateless link</figcaption></figure><p id="4ddf">Stateless links can also be written by extending the <code>ApolloLink</code> class and overwriting the request method. This is one way to store information about an individual link for each request.</p><figure id="cc01"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div></figure><h4 id="c501">Stateful links</h4><p id="9f1b">Sometimes a link may have different behavior based on other requests that are being executed. One such example is a link to batch requests into a single HTTP request instead of sending many at slightly different times. In order to do this, links can keep track of all operations being sent through them. The operation has a <code>toKey</code> method which will return a unique string based on the operation. Using this, you can write a link that manages application state easily:</p><figure id="0428"><div><div><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars3.githubusercontent.com%2Fu%2F4967600%3Fv%3D4%26s%3D400&key=a19fcc184b9711e1b4764040d3dc5c07&width=40" /></div></figure>